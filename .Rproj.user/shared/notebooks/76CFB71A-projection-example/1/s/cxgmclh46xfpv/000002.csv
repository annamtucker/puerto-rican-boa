"0","set.seed(60)"
"0","# parametric uncertainty SD"
"0","para.sd.mat = avg.mat*0.15"
"0","# to isolate survival rates only"
"0","surv.mask = matrix(c(1, 0, 0, 0,"
"0","                     1, 1, 0, 0,"
"0","                     0, 1, 1, 0,"
"0","                     0, 0, 1, 1),"
"0","                   nrow = 4, ncol = 4, byrow = T)"
"0","# to isolate fecundities only"
"0","fec.mask = matrix(c(0, 0, 1, 1, "
"0","                    0, 0, 0, 0,"
"0","                    0, 0, 0, 0,"
"0","                    0, 0, 0, 0),"
"0","                  nrow = 4, ncol = 4, byrow = T)"
"0","# natural"
"0","surv = avg.mat*surv.mask"
"0","surv.sd = para.sd.mat*surv.mask"
"0","  "
"0","avg.surv = matrix(get_beta_vals(16, surv, surv.sd),"
"0","                  nrow = 4, ncol = 4)"
"0","avg.surv[4,4] <- AS"
"0","fec = avg.mat*fec.mask"
"0","fec.sd = para.sd.mat*fec.mask"
"0","  "
"0","avg.fec = matrix(rlnorm(16, log(fec), fec.sd),"
"0","                   nrow = 4, ncol = 4)"
"0","  "
"0","avg = avg.surv + avg.fec"
"0","#urban"
"0","urb.avg = avg*urban.effect"
"0","# temporal variation"
"0","yr.surv.mat = avg*surv.mask"
"0","yr.surv.mat.U = urb.avg*surv.mask"
"0","yr.surv.sd = yr.surv.mat*0.15"
"0","yr.surv.sd.U = yr.surv.mat.U*0.15"
"0","yr.fec.mat = avg*fec.mask"
"0","yr.fec.mat.U = urb.avg*fec.mask"
"0","yr.fec.sd = yr.fec.mat*0.15"
"0","yr.fec.sd.U = yr.fec.mat.U*0.15"
"0","max.fec = 35"
"0","if(yr.fec.sd[1,3] < 1){yr.fec.sd[1,3] = 1.1}"
"0","if(yr.fec.sd[1,4] < 1){yr.fec.sd[1,4] = 1.1}"
"0","if(yr.fec.sd.U[1,3] < 1){yr.fec.sd.U[1,3] = 1.1}"
"0","if(yr.fec.sd.U[1,4] < 1){yr.fec.sd.U[1,4] = 1.1}"
"0","mat = array(NA, dim = c(30, 4, 4))"
"0","for(i in 1:30){"
"0","  yr.surv = matrix(get_beta_vals(16, yr.surv.mat, yr.surv.sd),"
"0","                   nrow = 4, ncol = 4)"
"0","  yr.fec = matrix(rlnorm(16, log(yr.fec.mat), log(yr.fec.sd)),"
"0","                  nrow = 4, ncol = 4)"
"0","  if(length(which(yr.fec > max.fec)) > 0) {"
"0","    yr.fec[which(yr.fec > max.fec)] <- max.fec"
"0","  }"
"0","  yr.fec[which(is.na(yr.fec))] <- 0 "
"0","    "
"0","  mat[i,,] <- yr.surv+yr.fec"
"0","}"
"0","mat[,4,4] <- yr.vals"
"0","mat.U = array(NA, dim = c(30, 4, 4))"
"0","for(i in 1:30){"
"0","  yr.surv.U = matrix(get_beta_vals(16, yr.surv.mat.U, yr.surv.sd.U),"
"0","                   nrow = 4, ncol = 4)"
"0","  yr.fec.U = matrix(rlnorm(16, log(yr.fec.mat.U), log(yr.fec.sd.U)),"
"0","                  nrow = 4, ncol = 4)"
"0","  if(length(which(yr.fec.U > max.fec)) > 0) {"
"0","    yr.fec[which(yr.fec.U > max.fec)] <- max.fec"
"0","  }"
"0","  yr.fec.U[which(is.na(yr.fec.U))] <- 0 "
"0","    "
"0","  mat.U[i,,] <- yr.surv.U+yr.fec.U"
"0","}"
"0","mat.U[,4,4] <- yr.vals.U"
"0","vals <- as.tibble(expand.grid(year = c(1:30), from = c(1:4), to = c(1:4))) %>% "
"0","  mutate(natural = c(mat),"
"0","         urban = c(mat.U)) %>%"
"0","  filter(natural > 0) %>% "
"0","  mutate(rate = case_when("
"0","    from == 1 & to == 1 ~ ""Young survive and remain young"","
"0","    from == 2 & to == 1 ~ ""Young survive and grow to juvenile"","
"0","    from == 2 & to == 2 ~ ""Juvenile survive and remain juvenile"","
"0","    from == 3 & to == 2 ~ ""Juvenile survive and grow to subadult"","
"0","    from == 3 & to == 3 ~ ""Subadult survive and remain subadult"","
"0","    from == 4 & to == 3 ~ ""Subadult survive and grow to adult"","
"0","    from == 4 & to == 4 ~ ""Adult survival"","
"0","    from == 1 & to == 3 ~ ""Subadult fecundity"","
"0","    from == 1 & to == 4 ~ ""Adult fecundity"""
"0","   )) %>% "
"0","  select(-from, -to) "
"0","facet_lims = data.frame(rate = rep(c(""Young survive and remain young"","
"0","                        ""Young survive and grow to juvenile"","
"0","                        ""Juvenile survive and remain juvenile"","
"0","                        ""Juvenile survive and grow to subadult"","
"0","                        ""Subadult survive and remain subadult"","
"0","                        ""Subadult survive and grow to adult"","
"0","                        ""Adult survival"","
"0","                        ""Subadult fecundity"","
"0","                        ""Adult fecundity""), each = 2),"
"0","               val = c(rep(c(0,1), 7), 0, 1, 0, 6),"
"0","               year = 1,"
"0","               habitat = ""natural"")"
"0","vals %>% "
"0","  gather(habitat, val, 2:3) %>% "
"0","  ggplot(aes(x = year, y = val, col = habitat)) +"
"0","  geom_line() +"
"0","  geom_point() +"
"0","  facet_wrap(~rate, labeller = label_wrap_gen(), scales = ""free"") +"
"0","  geom_blank(data = facet_lims) +"
"0","  scale_color_discrete(name = """") +"
"0","  theme(legend.position = ""top"","
"0","        strip.background = element_rect(fill = ""white""),"
"0","        strip.text = element_text(margin = margin(2,2,2,2))) +"
"0","  xlab(""Year"") +"
"0","  ylab(""Realized rates"")"
