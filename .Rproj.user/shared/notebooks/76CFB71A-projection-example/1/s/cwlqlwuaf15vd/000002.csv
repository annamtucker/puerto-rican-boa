"0","Ninit = round(runif(1, Ninit.min, Ninit.max))"
"0","K = round(runif(1, K.min, K.max))"
"0","dist = eigen.analysis(avg.mat)$stable.stage"
"0","init = tibble(Stage = c(""Young"", ""Juvenile"", ""Subadult"", ""Adult"", ""Total""),"
"0","              `Proportion in each stage` = c(round(dist, 3), 1),"
"0","              `Initial number, natural habitat` = c(round(Ninit*0.57*dist), round(Ninit*0.57)),"
"0","              `Initial number, urban habitat` = c(round(Ninit*0.43*dist), round(Ninit*0.43))"
"0",")"
"0","# parametric uncertainty SD"
"0","para.sd.mat = avg.mat*0.15"
"0","# to isolate survival rates only"
"0","surv.mask = matrix(c(1, 0, 0, 0,"
"0","                     1, 1, 0, 0,"
"0","                     0, 1, 1, 0,"
"0","                     0, 0, 1, 1),"
"0","                   nrow = 4, ncol = 4, byrow = T)"
"0","# to isolate fecundities only"
"0","fec.mask = matrix(c(0, 0, 1, 1, "
"0","                    0, 0, 0, 0,"
"0","                    0, 0, 0, 0,"
"0","                    0, 0, 0, 0),"
"0","                  nrow = 4, ncol = 4, byrow = T)"
"0","# natural"
"0","surv = avg.mat*surv.mask"
"0","surv.sd = para.sd.mat*surv.mask"
"0","  "
"0","avg.surv = matrix(get_beta_vals(16, surv, surv.sd),"
"0","                  nrow = 4, ncol = 4)"
"0","fec = avg.mat*fec.mask"
"0","fec.sd = para.sd.mat*fec.mask"
"0","  "
"0","avg.fec = matrix(rlnorm(16, log(fec), fec.sd),"
"0","                   nrow = 4, ncol = 4)"
"0","  "
"0","avg = avg.surv + avg.fec"
"0","#urban"
"0","urb.avg = avg*urban.effect"
"0","# temporal variation"
"0","yr.surv.mat = avg*surv.mask"
"0","yr.surv.mat.U = urb.avg*surv.mask"
"0","yr.surv.sd = yr.surv.mat*0.15"
"0","yr.surv.sd.U = yr.surv.mat.U*0.15"
"0","yr.fec.mat = avg*fec.mask"
"0","yr.fec.mat.U = urb.avg*fec.mask"
"0","yr.fec.sd = yr.fec.mat*0.15"
"0","yr.fec.sd.U = yr.fec.mat.U*0.15"
"0","max.fec = 35"
"0","if(yr.fec.sd[1,3] < 1){yr.fec.sd[1,3] = 1.1}"
"0","if(yr.fec.sd[1,4] < 1){yr.fec.sd[1,4] = 1.1}"
"0","if(yr.fec.sd.U[1,3] < 1){yr.fec.sd.U[1,3] = 1.1}"
"0","if(yr.fec.sd.U[1,4] < 1){yr.fec.sd.U[1,4] = 1.1}"
"0","mat = array(NA, dim = c(30, 4, 4))"
"0","for(i in 1:30){"
"0","  yr.surv = matrix(get_beta_vals(16, yr.surv.mat, yr.surv.sd),"
"0","                   nrow = 4, ncol = 4)"
"0","  yr.fec = matrix(rlnorm(16, log(yr.fec.mat), log(yr.fec.sd)),"
"0","                  nrow = 4, ncol = 4)"
"0","  if(length(which(yr.fec > max.fec)) > 0) {"
"0","    yr.fec[which(yr.fec > max.fec)] <- max.fec"
"0","  }"
"0","  yr.fec[which(is.na(yr.fec))] <- 0 "
"0","    "
"0","  mat[i,,] <- yr.surv+yr.fec"
"0","}"
"0","mat[,4,4] <- yr.vals"
"0","mat.U = array(NA, dim = c(30, 4, 4))"
"0","for(i in 1:30){"
"0","  yr.surv.U = matrix(get_beta_vals(16, yr.surv.mat.U, yr.surv.sd.U),"
"0","                   nrow = 4, ncol = 4)"
"0","  yr.fec.U = matrix(rlnorm(16, log(yr.fec.mat.U), log(yr.fec.sd.U)),"
"0","                  nrow = 4, ncol = 4)"
"0","  if(length(which(yr.fec.U > max.fec)) > 0) {"
"0","    yr.fec[which(yr.fec.U > max.fec)] <- max.fec"
"0","  }"
"0","  yr.fec.U[which(is.na(yr.fec.U))] <- 0 "
"0","    "
"0","  mat.U[i,,] <- yr.surv.U+yr.fec.U"
"0","}"
"0","mat.U[,4,4] <- yr.vals.U"
"0","N = matrix(NA, nrow = 4, ncol = 30)"
"0","N[,1] <- init$`Initial number, natural habitat`[1:4]"
"0","  "
"0","# project with temporal variation"
"0","for(i in 2:30){"
"0","    "
"0","  # set fecundity = 0 if pop exceeds K"
"0","  if(sum(N[,i-1]) > (K*0.913)){"
"0","    mat[i-1,1,3:4] <- 0"
"0","  }"
"0","    "
"0","  N[,i] <- round(mat[i-1,,] %*% N[,i-1])"
"0","}"
"0","Ntot = apply(N, 2, sum)"
"0","# urban"
"0","N.U = matrix(NA, nrow = 4, ncol = 30)"
"0","N.U[,1] <- init$`Initial number, urban habitat`[1:4]"
"0","  "
"0","# project with temporal variation"
"0","for(i in 2:30){"
"0","    "
"0","  # set fecundity = 0 if pop exceeds K"
"0","  if(sum(N.U[,i-1]) > (K*0.087)){"
"0","    mat.U[i-1,1,3:4] <- 0"
"0","  }"
"0","    "
"0","  N.U[,i] <- round(mat.U[i-1,,] %*% N.U[,i-1])"
"0","}"
"0","Ntot.U = apply(N.U, 2, sum)"
"0","data.frame(year = c(1:30),"
"0","           natural = Ntot, "
"0","           urban = Ntot.U) %>% "
"0","  mutate(total = natural+urban) %>% "
"0","  gather(habitat, N, 2:4) %>% "
"0","  mutate(habitat = fct_relevel(as.factor(habitat), ""total"")) %>% "
"0","  ggplot(aes(x = year, y = N, col = habitat)) +"
"0","  geom_line(aes(alpha = habitat)) +"
"0","  geom_point(aes(alpha = habitat)) +"
"0","  scale_color_manual(values = c(""black"", ""#F8766D"", ""#00BFC4""), name = """") +"
"0","  scale_alpha_manual(values = c(1, 0.5, 0.5), guide = F) +"
"0","  theme(legend.position = ""top"") +"
"0","  xlab(""Year"") +"
"0","  ylab(""Population size"")"
